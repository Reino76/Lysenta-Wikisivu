<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Lysenta Kokonaisuudessaan</title>
<link rel="stylesheet" href="assets/style.css">
<link rel="icon" href="assets/favicon.svg" type="image/svg+xml">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Metal+Mania&family=Texturina:wght@400;700&display=swap" rel="stylesheet">
</head>
<body class="dark">

<header class="site-header">
  <a class="home" href="index.html">Takaisin alkusivulle</a>
  <nav class="nav">
    <a href="world.html">Lysentan Maailma</a>
    <a href="characters.html">Hahmot</a>
    <a href="sessions.html">Pelikerrat</a>
  </nav>
</header>

<div class="page-content">
  <nav class="sidebar">
    <h2>Maanosat</h2>
    <a href="world/regions/exampleregion.html" class="category-link">Exampleregion</a>
  </nav>

  <main class="container">
    <section>
      <h2>Lysenta Kokonaisuudessaan</h2>

      <div class="map-wrap">
        <img src="assets/images/Lysenta_Raw.png" alt="World map of Lysenta">
        
        <a class="map-pin general" href="#exampleregion-card" style="top:20%; left:40%;" title="Exampleregion"></a>
        </div>
      <div class="grid" style="margin-bottom: 40px; margin-top: 10px;">
        <div class="lore-box">
          <h3>Nielemät (The Swallowing)</h3>
          <p>Lysenta on maailma, jonka yllä leijuu ikuinen varjo. "Nielemät" on pimeä mahti, joka pyrkii kuluttamaan kaiken valon ja toivon. Tämä ikiaikainen taistelu hyvän ja pahan välillä määrittää koko maailman historian ja maantieteen.</p>
        </div>
        <div class="lore-box">
          <h3>Ensimmäinen Loimu ja Myytit</h3>
          <p>Muinaisten myyttien mukaan Lysenta syntyi Ensimmäisen Lohen (First Flame) sammuessa, jolloin pimeä aine alkoi sulaa todellisuuteen. Suuret mantereet ovat eristyksissä toisistaan myrskyisten merien ja maagisten esteiden vuoksi.</p>
        </div>
      </div>
      <div id="exampleregion" class="category-break">Exampleregion</div>
      <div class="gallery">
        <a href="world/regions/exampleregion.html">
          <div class="card" id="exampleregion-card">
            <h3>Exampleregion</h3>
            <p>A frozen continent of warring clans, old sagas, and the slumbering Dragonpeak.</p>
          </div>
        </a>
      </div>

    </section>
  </main>
</div>

<div id="map-tooltip">
  <h3 id="tooltip-title">Location Name</h3>
  <button id="tooltip-button">Go to Details</button>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const mapWrap = document.querySelector('.map-wrap');
    if (!mapWrap) return;

    const tooltip = document.getElementById('map-tooltip');
    const tooltipTitle = document.getElementById('tooltip-title');
    const tooltipButton = document.getElementById('tooltip-button');
    const mapPins = document.querySelectorAll('.map-pin');
    let hideTimeout;

    const showTooltip = (pin) => {
      clearTimeout(hideTimeout);

      const mapRect = mapWrap.getBoundingClientRect();
      const locationName = pin.getAttribute('title');
      const targetId = pin.getAttribute('href');

      const pinTopPercent = parseFloat(pin.style.top);
      const pinLeftPercent = parseFloat(pin.style.left);
      const pinAbsX = mapRect.left + window.scrollX + (pinLeftPercent / 100) * mapWrap.offsetWidth;
      const pinAbsY = mapRect.top + window.scrollY + (pinTopPercent / 100) * mapWrap.offsetHeight;

      tooltipTitle.textContent = locationName;
      tooltip.style.top = `${pinAbsY}px`;
      tooltip.style.left = `${pinAbsX}px`;
      tooltip.dataset.target = targetId;
      tooltip.classList.add('visible');
    };

    const hideTooltip = () => {
      hideTimeout = setTimeout(() => {
        tooltip.classList.remove('visible');
      }, 300);
    };

    mapPins.forEach(pin => {
      pin.addEventListener('mouseenter', () => showTooltip(pin));
      pin.addEventListener('mouseleave', hideTooltip);
    });

    tooltip.addEventListener('mouseenter', () => clearTimeout(hideTimeout));
    tooltip.addEventListener('mouseleave', hideTooltip);

    tooltipButton.addEventListener('click', () => {
      const targetId = tooltip.dataset.target;
      if (!targetId) return;

      // **FIXED LOGIC**
      const targetCard = document.querySelector(targetId);
      if (targetCard) {
        targetCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
        targetCard.classList.add('highlight-target');
        setTimeout(() => {
          targetCard.classList.remove('highlight-target');
        }, 1200);
      }
      tooltip.classList.remove('visible');
    });
  });
</script>

</body>
</html>